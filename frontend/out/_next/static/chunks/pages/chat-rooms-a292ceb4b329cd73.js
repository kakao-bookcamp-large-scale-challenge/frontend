(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[301],{48331:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat-rooms",function(){return t(33574)}])},83867:(e,r,t)=>{"use strict";t.d(r,{Q:()=>i,v:()=>c});var a=t(85893),o=t(67294),l=t(11163),n=t(31530),s=t(19182);let i=e=>{let r=r=>{let t=(0,l.useRouter)(),[n,i]=(0,o.useState)(!0);return((0,o.useEffect)(()=>{s.Z.getCurrentUser()?i(!1):t.replace("/?redirect="+t.asPath)},[t]),n)?null:(0,a.jsx)(e,{...r})},t=e.displayName||e.name||"Component";return r.displayName="WithAuth(".concat(t,")"),r},c=e=>{let r=r=>{let t=(0,l.useRouter)(),[i,c]=(0,o.useState)(!0);return((0,o.useEffect)(()=>{(async()=>{t.isReady&&(s.Z.getCurrentUser()&&"/"===t.pathname?await t.replace("/chat-rooms"):c(!1))})()},[t,t.isReady]),i)?(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",backgroundColor:"var(--vapor-color-background)",color:"var(--vapor-color-text-primary)"},children:(0,a.jsx)(n.x,{typography:"body1",children:"Loading..."})}):(0,a.jsx)(e,{...r})},t=e.displayName||e.name||"Component";return r.displayName="WithoutAuth(".concat(t,")"),r}},4987:(e,r,t)=>{"use strict";t.d(r,{C:()=>x}),t(20798);var a=t(67294),o=t(36370),l=t(90512),n=t(64584),s=t(85893),i=Object.defineProperty,c=Object.defineProperties,d=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,m=(e,r,t)=>r in e?i(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,f=(e,r)=>{for(var t in r||(r={}))h.call(r,t)&&m(e,t,r[t]);if(u)for(var t of u(r))p.call(r,t)&&m(e,t,r[t]);return e},y=(e,r)=>c(e,d(r)),g=(e,r)=>{var t={};for(var a in e)h.call(e,a)&&0>r.indexOf(a)&&(t[a]=e[a]);if(null!=e&&u)for(var a of u(e))0>r.indexOf(a)&&p.call(e,a)&&(t[a]=e[a]);return t},b=()=>(e,r)=>r.reduce((e,r)=>{let[t,a]=e;return void 0!==a[r]&&(t[r]=a[r]),delete a[r],[t,a]},[{},f({},e)]),v=(0,n.c)({defaultClassName:"badge__14317c4c badge__14317c40",variantClassNames:{color:{primary:"badge__14317c41",hint:"badge__14317c42",danger:"badge__14317c43",success:"badge__14317c44",warning:"badge__14317c45",contrast:"badge__14317c46"},shape:{square:"badge__14317c47",pill:"badge__14317c48"},size:{sm:"badge__14317c49",md:"badge__14317c4a",lg:"badge__14317c4b"}},defaultVariants:{color:"primary",size:"md",shape:"square"},compoundVariants:[]}),x=(0,a.forwardRef)((e,r)=>{var{className:t,children:a}=e,n=g(e,["className","children"]);let[i,c]=b()(n,["color","size","shape"]);return(0,s.jsx)(o.WV.span,y(f({ref:r,className:(0,l.Z)(v(i),t)},c),{children:a}))});x.displayName="Badge"},2026:(e,r,t)=>{"use strict";t.d(r,{U:()=>x}),t(77507);var a=t(67294),o=t(36370),l=t(90512),n=t(64584),s=t(85893),i=Object.defineProperty,c=Object.defineProperties,d=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,m=(e,r,t)=>r in e?i(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,f=(e,r)=>{for(var t in r||(r={}))h.call(r,t)&&m(e,t,r[t]);if(u)for(var t of u(r))p.call(r,t)&&m(e,t,r[t]);return e},y=(e,r)=>c(e,d(r)),g=(e,r)=>{var t={};for(var a in e)h.call(e,a)&&0>r.indexOf(a)&&(t[a]=e[a]);if(null!=e&&u)for(var a of u(e))0>r.indexOf(a)&&p.call(e,a)&&(t[a]=e[a]);return t},b=()=>(e,r)=>r.reduce((e,r)=>{let[t,a]=e;return void 0!==a[r]&&(t[r]=a[r]),delete a[r],[t,a]},[{},f({},e)]),v=(0,n.c)({defaultClassName:"callout__17t9x5h7 callout__17t9x5h0",variantClassNames:{color:{primary:"callout__17t9x5h1",success:"callout__17t9x5h2",warning:"callout__17t9x5h3",danger:"callout__17t9x5h4",hint:"callout__17t9x5h5",contrast:"callout__17t9x5h6"}},defaultVariants:{color:"primary"},compoundVariants:[]}),x=(0,a.forwardRef)((e,r)=>{var{className:t,children:a}=e,n=g(e,["className","children"]);let[i,c]=b()(n,["color"]);return(0,s.jsx)(o.WV.div,y(f({ref:r,className:(0,l.Z)(v(i),t)},c),{children:a}))});x.displayName="Callout"},1539:(e,r,t)=>{"use strict";t.d(r,{Zb:()=>_}),t(93406);var a=t(67294),o=t(36370),l=t(90512),n=t(85893),s=Object.defineProperty,i=Object.defineProperties,c=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,p=(e,r,t)=>r in e?s(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,m=(e,r)=>{for(var t in r||(r={}))u.call(r,t)&&p(e,t,r[t]);if(d)for(var t of d(r))h.call(r,t)&&p(e,t,r[t]);return e},f=(e,r)=>i(e,c(r)),y=(e,r)=>{var t={};for(var a in e)u.call(e,a)&&0>r.indexOf(a)&&(t[a]=e[a]);if(null!=e&&d)for(var a of d(e))0>r.indexOf(a)&&h.call(e,a)&&(t[a]=e[a]);return t},g=(0,a.forwardRef)((e,r)=>{var{className:t,children:a}=e,s=y(e,["className","children"]);return(0,n.jsx)(o.WV.div,f(m({ref:r,className:(0,l.Z)("card__18rs0li0",t)},s),{children:a}))});g.displayName="Card";var b=(0,a.forwardRef)((e,r)=>{var{className:t,children:a}=e,s=y(e,["className","children"]);return(0,n.jsx)(o.WV.div,f(m({ref:r,className:(0,l.Z)("card__18rs0li1",t)},s),{children:a}))});b.displayName="Card.Header";var v=(0,a.forwardRef)((e,r)=>{var{className:t,children:a}=e,s=y(e,["className","children"]);return(0,n.jsx)(o.WV.div,f(m({ref:r,className:(0,l.Z)("card__18rs0li2",t)},s),{children:a}))});v.displayName="Card.Body";var x=(0,a.forwardRef)((e,r)=>{var{className:t,children:a}=e,s=y(e,["className","children"]);return(0,n.jsx)(o.WV.div,f(m({ref:r,className:(0,l.Z)("card__18rs0li3",t)},s),{children:a}))});x.displayName="Card.Footer";var _={Root:g,Header:b,Body:v,Footer:x}},32602:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{default:function(){return s},noSSR:function(){return n}});let a=t(38754);t(85893),t(67294);let o=a._(t(35491));function l(e){return{default:(null==e?void 0:e.default)||e}}function n(e,r){return delete r.webpack,delete r.modules,e(r)}function s(e,r){let t=o.default,a={loading:e=>{let{error:r,isLoading:t,pastDelay:a}=e;return null}};e instanceof Promise?a.loader=()=>e:"function"==typeof e?a.loader=e:"object"==typeof e&&(a={...a,...e});let s=(a={...a,...r}).loader;return(a.loadableGenerated&&(a={...a,...a.loadableGenerated},delete a.loadableGenerated),"boolean"!=typeof a.ssr||a.ssr)?t({...a,loader:()=>null!=s?s().then(l):Promise.resolve(l(()=>null))}):(delete a.webpack,delete a.modules,n(t,a))}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),e.exports=r.default)},1159:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"LoadableContext",{enumerable:!0,get:function(){return a}});let a=t(38754)._(t(67294)).default.createContext(null)},35491:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return h}});let a=t(38754)._(t(67294)),o=t(1159),l=[],n=[],s=!1;function i(e){let r=e(),t={loading:!0,loaded:null,error:null};return t.promise=r.then(e=>(t.loading=!1,t.loaded=e,e)).catch(e=>{throw t.loading=!1,t.error=e,e}),t}class c{promise(){return this._res.promise}retry(){this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};let{_res:e,_opts:r}=this;e.loading&&("number"==typeof r.delay&&(0===r.delay?this._state.pastDelay=!0:this._delay=setTimeout(()=>{this._update({pastDelay:!0})},r.delay)),"number"==typeof r.timeout&&(this._timeout=setTimeout(()=>{this._update({timedOut:!0})},r.timeout))),this._res.promise.then(()=>{this._update({}),this._clearTimeouts()}).catch(e=>{this._update({}),this._clearTimeouts()}),this._update({})}_update(e){this._state={...this._state,error:this._res.error,loaded:this._res.loaded,loading:this._res.loading,...e},this._callbacks.forEach(e=>e())}_clearTimeouts(){clearTimeout(this._delay),clearTimeout(this._timeout)}getCurrentValue(){return this._state}subscribe(e){return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}constructor(e,r){this._loadFn=e,this._opts=r,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}}function d(e){return function(e,r){let t=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null},r),l=null;function i(){if(!l){let r=new c(e,t);l={getCurrentValue:r.getCurrentValue.bind(r),subscribe:r.subscribe.bind(r),retry:r.retry.bind(r),promise:r.promise.bind(r)}}return l.promise()}if(!s){let e=t.webpack?t.webpack():t.modules;e&&n.push(r=>{for(let t of e)if(r.includes(t))return i()})}function d(e,r){!function(){i();let e=a.default.useContext(o.LoadableContext);e&&Array.isArray(t.modules)&&t.modules.forEach(r=>{e(r)})}();let n=a.default.useSyncExternalStore(l.subscribe,l.getCurrentValue,l.getCurrentValue);return a.default.useImperativeHandle(r,()=>({retry:l.retry}),[]),a.default.useMemo(()=>{var r;return n.loading||n.error?a.default.createElement(t.loading,{isLoading:n.loading,pastDelay:n.pastDelay,timedOut:n.timedOut,error:n.error,retry:l.retry}):n.loaded?a.default.createElement((r=n.loaded)&&r.default?r.default:r,e):null},[e,n])}return d.preload=()=>i(),d.displayName="LoadableComponent",a.default.forwardRef(d)}(i,e)}function u(e,r){let t=[];for(;e.length;){let a=e.pop();t.push(a(r))}return Promise.all(t).then(()=>{if(e.length)return u(e,r)})}d.preloadAll=()=>new Promise((e,r)=>{u(l).then(e,r)}),d.preloadReady=e=>(void 0===e&&(e=[]),new Promise(r=>{let t=()=>(s=!0,r());u(n,e).then(t,t)})),window.__NEXT_PRELOADREADY=d.preloadReady;let h=d},33574:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>V});var a=t(85893),o=t(67294),l=t(11163),n=t(5152),s=t.n(n),i=t(18237),c=t(31530),d=t(4987),u=t(74303),h=t(1539),p=t(2026),m=t(22226),f=t(39781);let y=e=>{let{children:r,className:t,...o}=e;return(0,a.jsx)("div",{className:(0,f.cn)("styled-table-wrapper",t),children:(0,a.jsx)("table",{className:"styled-table",...o,children:r})})},g=e=>{let{children:r,className:t,...o}=e;return(0,a.jsx)("thead",{className:(0,f.cn)("styled-table-head",t),...o,children:r})},b=e=>{let{children:r,className:t,...o}=e;return(0,a.jsx)("tbody",{className:(0,f.cn)("styled-table-body",t),...o,children:r})},v=e=>{let{children:r,className:t,onClick:o,...l}=e;return(0,a.jsx)("tr",{className:(0,f.cn)("styled-table-row",o&&"clickable",t),onClick:o,...l,children:r})},x=e=>{let{children:r,className:t,width:o,...l}=e;return(0,a.jsx)("th",{className:(0,f.cn)("styled-table-header",t),style:{width:o,...l.style},...l,children:r})},_=e=>{let{children:r,className:t,...o}=e;return(0,a.jsx)("td",{className:(0,f.cn)("styled-table-cell",t),...o,children:r})};var j=t(37804),w=t(19182),N=t(87066);let C="http://3.38.186.15:5001";C||console.warn("Warning: NEXT_PUBLIC_API_URL is not defined in environment variables");let E={maxRetries:3,initialDelayMs:1e3,maxDelayMs:5e3,backoffFactor:2,retryableStatuses:[408,429,500,502,503,504],retryableErrors:["ECONNABORTED","ETIMEDOUT","ENOTFOUND","ENETUNREACH","ERR_NETWORK"]},R=N.default.create({baseURL:C||"http://localhost:5000",timeout:3e4,withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}}),O=e=>Math.min(E.initialDelayMs*Math.pow(E.backoffFactor,e)*(1+.1*Math.random()),E.maxDelayMs),k=e=>{var r;return!!e&&(!!(e.code&&E.retryableErrors.includes(e.code)||(null===(r=e.response)||void 0===r?void 0:r.status)&&E.retryableStatuses.includes(e.response.status))||!e.response&&!!e.request)},T=new Map;R.interceptors.request.use(async e=>{try{"get"===e.method||e.data||(e.data={});let r=w.Z.getCurrentUser();return(null==r?void 0:r.token)&&(e.headers["x-auth-token"]=r.token,r.sessionId&&(e.headers["x-session-id"]=r.sessionId)),e}catch(e){return console.error("Request interceptor error:",e),Promise.reject(e)}},e=>Promise.reject(e)),R.interceptors.response.use(e=>{let r="".concat(e.config.method,":").concat(e.config.url);return T.delete(r),e},async e=>{let r;let t=e.config||{};if(t.retryCount=t.retryCount||0,N.default.isCancel(e))return console.log("Request canceled:",e.message),Promise.reject(e);if(k(e)&&t.retryCount<E.maxRetries){t.retryCount++;let e=O(t.retryCount);console.log("Retrying request (".concat(t.retryCount,"/").concat(E.maxRetries,") ")+"after ".concat(Math.round(e),"ms:"),t.url);try{return await new Promise(r=>setTimeout(r,e)),await R(t)}catch(e){return t.retryCount>=E.maxRetries&&console.error("Max retry attempts reached:",t.url),Promise.reject(e)}}if(!e.response){let r=Error();throw r.message=["서버와 통신할 수 없습니다.","네트워크 연결을 확인하고 잠시 후 다시 시도해주세요.",e.code?"(Error: ".concat(e.code,")"):""].filter(Boolean).join(" "),r.isNetworkError=!0,r.originalError=e,r.status=0,r.code=e.code||"NETWORK_ERROR",r.config=t,r.retry=async()=>{try{return await R(t)}catch(e){throw console.error("Manual retry failed:",e),e}},r}let a=e.response.status,o=e.response.data;switch(a){case 400:r=(null==o?void 0:o.message)||"잘못된 요청입니다.";break;case 401:r="인증이 필요하거나 만료되었습니다.";break;case 403:r=(null==o?void 0:o.message)||"접근 권한이 없습니다.";break;case 404:r=(null==o?void 0:o.message)||"요청한 리소스를 찾을 수 없습니다.";break;case 408:r="요청 시간이 초과되었습니다.";break;case 429:r="너무 많은 요청이 발생했습니다. 잠시 후 다시 시도해주세요.";break;case 500:r="서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.";break;case 502:case 503:case 504:r="서버가 일시적으로 응답할 수 없습니다. 잠시 후 다시 시도해주세요.";break;default:r=(null==o?void 0:o.message)||"예기치 않은 오류가 발생했습니다."}let l=Error(r);if(l.status=a,l.code=null==o?void 0:o.code,l.data=o,l.config=t,l.originalError=e,l.retry=async()=>{try{return await R(t)}catch(e){throw console.error("Manual retry failed:",e),e}},401===a)try{if(await w.Z.refreshToken()){let e=w.Z.getCurrentUser();if(null==e?void 0:e.token)return t.headers["x-auth-token"]=e.token,R(t)}}catch(e){console.error("Token refresh failed:",e),w.Z.logout(),window.location.href="/?error=session_expired"}throw l});var S=t(83867),D=t(78536);let P={CHECKING:"checking",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected",ERROR:"error"},I={[P.CHECKING]:{label:"연결 확인 중...",color:"warning"},[P.CONNECTING]:{label:"연결 중...",color:"warning"},[P.CONNECTED]:{label:"연결됨",color:"success"},[P.DISCONNECTED]:{label:"연결 끊김",color:"danger"},[P.ERROR]:{label:"연결 오류",color:"danger"}},M={maxRetries:3,baseDelay:1e3,maxDelay:5e3,backoffFactor:2},L=e=>{let{text:r}=e;return(0,a.jsxs)("div",{className:"loading-indicator",children:[(0,a.jsx)("div",{className:"spinner-border spinner-border-sm me-3",role:"status",children:(0,a.jsx)("span",{className:"visually-hidden",children:"Loading..."})}),(0,a.jsx)(c.x,{typography:"body3",foreground:"secondary",children:r})]})},A=e=>{let{children:r,onScroll:t,loadingMore:l,hasMore:n,rooms:s}=e,i=(0,o.useRef)(null),d=(0,o.useRef)(null),u=(0,o.useRef)(Date.now()),h=(0,o.useCallback)(e=>{let r=Date.now(),a=e.target;if(r-u.current>=150){let{scrollHeight:e,scrollTop:o,clientHeight:s}=a,i=e-(o+s);if(console.log("Scroll check:",{scrollHeight:e,scrollTop:o,clientHeight:s,distanceToBottom:i,loadingMore:l,hasMore:n,timeSinceLastCheck:r-u.current}),i<50&&!l&&n){console.log("Triggering load more..."),u.current=r,t();return}u.current=r}else d.current||(d.current=setTimeout(()=>{let{scrollHeight:e,scrollTop:r,clientHeight:o}=a,s=e-(r+o);console.log("Debounced scroll check:",{scrollHeight:e,scrollTop:r,clientHeight:o,distanceToBottom:s,loadingMore:l,hasMore:n}),s<50&&!l&&n&&(console.log("Triggering load more (debounced)..."),t()),d.current=null,u.current=Date.now()},150))},[l,n,t]);return(0,o.useEffect)(()=>{let e=i.current;return e&&e.addEventListener("scroll",h,{passive:!0}),()=>{e&&e.removeEventListener("scroll",h),d.current&&(clearTimeout(d.current),d.current=null)}},[h]),(0,a.jsxs)("div",{ref:i,className:"chat-rooms-table",style:{height:"430px",overflowY:"auto",position:"relative",borderRadius:"0.5rem",backgroundColor:"var(--background-normal)",border:"1px solid var(--border-color)",scrollBehavior:"smooth",WebkitOverflowScrolling:"touch"},children:[r,l&&(0,a.jsx)("div",{className:"flex items-center justify-center gap-2 p-4 border-t border-gray-700",children:(0,a.jsx)(L,{text:"추가 채팅방을 불러오는 중..."})}),!n&&(null==s?void 0:s.length)>0&&(0,a.jsx)(m.kC,{justify:"center",align:"center",style:{padding:"var(--vapor-space-300)",borderTop:"1px solid var(--vapor-color-border)",width:"100%"},children:(0,a.jsx)(c.x,{typography:"body2",color:"secondary",style:{textAlign:"center"},children:"모든 채팅방을 불러왔습니다."})})]})};function Z(){let e=(0,l.useRouter)(),[r,t]=(0,o.useState)([]),[n,s]=(0,o.useState)(null),[f,N]=(0,o.useState)(!0),[C,E]=(0,o.useState)(!1),[O]=(0,o.useState)(w.Z.getCurrentUser()),[k,T]=(0,o.useState)(P.CHECKING),[S,Z]=(0,o.useState)(0),[U,V]=(0,o.useState)(!1),[z,F]=(0,o.useState)([{id:"createdAt",desc:!0}]),[B,W]=(0,o.useState)(0),[q]=(0,o.useState)(10),[G,K]=(0,o.useState)(!0),[H,X]=(0,o.useState)(!0),[Q,Y]=(0,o.useState)(!1),J=(0,o.useRef)(null);(0,o.useRef)(null);let $=(0,o.useRef)(null),ee=(0,o.useRef)(!1),er=(0,o.useRef)([]),et=(0,o.useRef)(0),ea=(0,o.useCallback)(e=>Math.min(M.baseDelay*Math.pow(M.backoffFactor,e)*(1+.1*Math.random()),M.maxDelay),[]),eo=(0,o.useCallback)(async r=>{try{var t,a,o;if(((null===(t=r.response)||void 0===t?void 0:t.status)===401||(null===(o=r.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.code)==="TOKEN_EXPIRED")&&await w.Z.refreshToken())return!0;return w.Z.logout(),e.replace("/?error=session_expired"),!1}catch(r){return console.error("Auth error handling failed:",r),w.Z.logout(),e.replace("/?error=auth_error"),!1}},[e]),el=(0,o.useCallback)((e,r)=>{let t="채팅방 목록을 불러오는데 실패했습니다.",a="danger",o=!U;if("SERVER_UNREACHABLE"===e.message&&(t="서버와 연결할 수 없습니다. 잠시 후 자동으로 재시도합니다.",a="warning",o=!0,!r&&S<M.maxRetries)){let e=ea(S);Z(e=>e+1),setTimeout(()=>{V(!0),es(r)},e)}r||s({title:"채팅방 목록 로드 실패",message:t,type:a,showRetry:o}),T(P.ERROR)},[U,S,ea]),en=(0,o.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{var r;T(P.CONNECTING);let e=await R.get("/health",{timeout:5e3,retries:1});if((null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.status)==="ok"&&(null==e?void 0:e.status)===200)return T(P.CONNECTED),Z(0),!0;throw Error("Server not ready")}catch(r){if(console.error("Connection attempt ".concat(e+1," failed:"),r),!r.response&&e<M.maxRetries){let r=ea(e);return await new Promise(e=>setTimeout(e,r)),en(e+1)}throw T(P.ERROR),Error("SERVER_UNREACHABLE")}},[ea]),es=(0,o.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!(null==O?void 0:O.token)||ee.current){console.log("Fetch prevented:",{hasToken:!!(null==O?void 0:O.token),isLoading:ee.current});return}try{var r,a,o;ee.current=!0,console.log("Fetching rooms:",{isLoadingMore:e,pageIndex:B}),e?E(!0):(N(!0),s(null)),await en();let l=await R.get("/api/rooms",{params:{page:e?B:0,pageSize:q,sortField:null===(r=z[0])||void 0===r?void 0:r.id,sortOrder:(null===(a=z[0])||void 0===a?void 0:a.desc)?"desc":"asc"}});if(!(null==l?void 0:null===(o=l.data)||void 0===o?void 0:o.data))throw Error("INVALID_RESPONSE");let{data:n,metadata:i}=l.data;console.log("Fetched rooms:",{count:n.length,hasMore:i.hasMore}),t(r=>{if(e){let e=new Set(r.map(e=>e._id)),t=n.filter(r=>!e.has(r._id));return[...r,...t]}return n}),K(n.length===q&&i.hasMore),H&&X(!1)}catch(r){console.error("Rooms fetch error:",r),el(r,e)}finally{e||N(!1),E(!1),ee.current=!1}},[O,B,q,z,H,en,el]),ei=(0,o.useCallback)(async()=>{if(C||!G||ee.current){console.log("Load more prevented:",{loadingMore:C,hasMore:G,isLoading:ee.current});return}try{var e,a,o;console.log("Loading more rooms..."),E(!0),ee.current=!0;let l=Math.floor(r.length/q);console.log("Loading page:",l),W(l);let n=await R.get("/api/rooms",{params:{page:l,pageSize:q,sortField:null===(e=z[0])||void 0===e?void 0:e.id,sortOrder:(null===(a=z[0])||void 0===a?void 0:a.desc)?"desc":"asc"}});if(null===(o=n.data)||void 0===o?void 0:o.success){let{data:e,metadata:r}=n.data;console.log("Loaded new rooms:",{count:e.length,hasMore:r.hasMore}),t(r=>{let t=new Set(r.map(e=>e._id)),a=e.filter(e=>!t.has(e._id));return console.log("Unique new rooms:",a.length),[...r,...a]}),K(e.length===q&&r.hasMore)}}catch(e){console.error("Load more rooms error:",e),el(e,!0)}finally{E(!1),ee.current=!1,D.F.info("추가 채팅방을 불러왔습니다.")}},[C,G,r.length,q,z,el]);(0,o.useEffect)(()=>{B>0&&es(!0)},[B,es]),(0,o.useEffect)(()=>{if(O)return(async()=>{try{await es(!1)}catch(e){console.error("Initial fetch failed:",e),setTimeout(()=>{k===P.CHECKING&&es(!1)},3e3)}})(),$.current=setInterval(()=>{k===P.CHECKING&&en()},5e3),()=>{$.current&&clearInterval($.current)}},[O,k,en,es]),(0,o.useEffect)(()=>{let e=()=>{console.log("Network is online"),T(P.CONNECTING),et.current=0,W(0),es(!1)},r=()=>{console.log("Network is offline"),T(P.DISCONNECTED),s({title:"네트워크 연결 끊김",message:"인터넷 연결을 확인해주세요.",type:"danger"})};return window.addEventListener("online",e),window.addEventListener("offline",r),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",r)}},[es]),(0,o.useEffect)(()=>{if(!(null==O?void 0:O.token))return;let e=!0;return(async()=>{try{let r=await j.Z.connect({auth:{token:O.token,sessionId:O.sessionId}});if(!e||!r)return;J.current=r,Object.entries({connect:()=>{T(P.CONNECTED),r.emit("joinRoomList")},disconnect:e=>{T(P.DISCONNECTED),console.log("Socket disconnected:",e)},error:e=>{console.error("Socket error:",e),T(P.ERROR)},roomCreated:e=>{t(r=>{let t=[e,...r];return er.current=t,t})},roomDeleted:e=>{t(r=>{let t=r.filter(r=>r._id!==e);return er.current=t,t})},roomUpdated:e=>{t(r=>{let t=r.map(r=>r._id===e._id?e:r);return er.current=t,t})}}).forEach(e=>{let[t,a]=e;r.on(t,a)})}catch(t){var r,a;if(console.error("Socket connection error:",t),!e)return;((null===(r=t.message)||void 0===r?void 0:r.includes("Authentication required"))||(null===(a=t.message)||void 0===a?void 0:a.includes("Invalid session")))&&eo({response:{status:401}}),T(P.ERROR)}})(),()=>{e=!1,J.current&&(J.current.disconnect(),J.current=null)}},[O,eo]);let ec=async t=>{if(k!==P.CONNECTED){s({title:"채팅방 입장 실패",message:"서버와 연결이 끊어져 있습니다.",type:"danger"});return}let a=r.find(e=>e._id===t),o="";if(null==a||!a.hasPassword||null!==(o=prompt("비밀번호를 입력하세요"))){Y(!0);try{(await R.post("/api/rooms/".concat(t,"/join"),{password:o},{timeout:5e3})).data.success&&e.push("/chat?room=".concat(t))}catch(r){var l,n,i,c;console.error("Room join error:",r);let e="입장에 실패했습니다.";(null===(l=r.response)||void 0===l?void 0:l.status)===404?e="채팅방을 찾을 수 없습니다.":(null===(n=r.response)||void 0===n?void 0:n.status)===403&&(e="비밀번호가 틀렸거나 입장 권한이 없습니다."),s({title:"채팅방 입장 실패",message:(null===(c=r.response)||void 0===c?void 0:null===(i=c.data)||void 0===i?void 0:i.message)||e,type:"danger"})}finally{Y(!1)}}};return(0,a.jsxs)("div",{className:"auth-container",children:[(0,a.jsx)(h.Zb.Root,{className:"chat-rooms-card",children:(0,a.jsxs)(h.Zb.Body,{className:"card-body",children:[(0,a.jsxs)(m.Kq,{gap:"300",align:"center",children:[(0,a.jsx)(c.x,{typography:"heading3",children:"채팅방 목록"}),(0,a.jsxs)(m.Ug,{gap:"200",children:[(0,a.jsx)(d.C,{color:"success"===I[k].color?"success":"warning"===I[k].color?"warning":"danger",children:I[k].label}),(n||k===P.ERROR)&&(0,a.jsxs)(u.z,{variant:"outline",color:"secondary",size:"sm",onClick:()=>{et.current=0,W(0),es(!1)},disabled:U,children:[(0,a.jsx)(i.MnU,{size:16}),"재연결"]})]})]}),n&&(0,a.jsx)(m.xu,{mt:"400",children:(0,a.jsx)(p.U,{color:"danger"===n.type?"danger":"warning"===n.type?"warning":"primary",className:"mb-4",children:(0,a.jsxs)(m.kC,{align:"flex-start",gap:"200",children:[k===P.ERROR?(0,a.jsx)(i.dFN,{size:16,style:{marginTop:"4px"}}):(0,a.jsx)(i.oC6,{size:16,style:{marginTop:"4px"}}),(0,a.jsxs)("div",{children:[(0,a.jsx)(c.x,{typography:"subtitle2",style:{fontWeight:500},children:n.title}),(0,a.jsx)(c.x,{typography:"body2",style:{marginTop:"var(--vapor-space-050)"},children:n.message}),n.showRetry&&!U&&(0,a.jsx)(u.z,{variant:"outline",color:"secondary",size:"sm",style:{marginTop:"var(--vapor-space-200)"},onClick:()=>{et.current=0,W(0),es(!1)},children:"다시 시도"})]})]})})}),f?(0,a.jsx)(m.xu,{mt:"400",children:(0,a.jsx)(L,{text:"채팅방 목록을 불러오는 중..."})}):r.length>0?(0,a.jsx)(m.xu,{mt:"400",children:(0,a.jsx)(A,{onScroll:ei,loadingMore:C,hasMore:G,rooms:r,children:r&&0!==r.length?(0,a.jsxs)(y,{children:[(0,a.jsx)(g,{children:(0,a.jsxs)(v,{children:[(0,a.jsx)(x,{width:"45%",children:"채팅방"}),(0,a.jsx)(x,{width:"15%",children:"참여자"}),(0,a.jsx)(x,{width:"25%",children:"생성일"}),(0,a.jsx)(x,{width:"15%",children:"액션"})]})}),(0,a.jsx)(b,{children:r.map(e=>{var r;return(0,a.jsxs)(v,{children:[(0,a.jsxs)(_,{children:[(0,a.jsx)(c.x,{typography:"body1",style:{fontWeight:500,marginBottom:"var(--vapor-space-050)"},children:e.name}),e.hasPassword&&(0,a.jsxs)(m.Ug,{gap:"050",align:"center",children:[(0,a.jsx)(i.mBM,{size:16,style:{color:"var(--vapor-color-warning)"}}),(0,a.jsx)(c.x,{typography:"body1",style:{color:"var(--vapor-color-warning)"},children:"비밀번호 필요"})]})]}),(0,a.jsx)(_,{children:(0,a.jsxs)(d.C,{color:"primary",style:{display:"inline-flex",alignItems:"center",gap:"var(--vapor-space-100)"},children:[(0,a.jsx)(i.BFJ,{size:16}),(0,a.jsx)(c.x,{typography:"body1",style:{color:"inherit"},children:(null===(r=e.participants)||void 0===r?void 0:r.length)||0})]})}),(0,a.jsx)(_,{children:(0,a.jsx)(c.x,{typography:"body1",style:{color:"var(--vapor-color-text-muted)"},children:new Date(e.createdAt).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})}),(0,a.jsx)(_,{children:(0,a.jsx)(u.z,{color:"primary",variant:"outline",size:"md",onClick:()=>ec(e._id),disabled:k!==P.CONNECTED,children:"입장"})})]},e._id)})})]}):null})}):!n&&(0,a.jsxs)(m.xu,{mt:"400",style:{textAlign:"center"},children:[(0,a.jsx)(c.x,{typography:"body1",style:{marginBottom:"var(--vapor-space-400)"},children:"생성된 채팅방이 없습니다."}),(0,a.jsx)(u.z,{color:"primary",onClick:()=>e.push("/chat-rooms/new"),disabled:k!==P.CONNECTED,children:"새 채팅방 만들기"})]})]})}),Q&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:(0,a.jsxs)(m.Kq,{align:"center",gap:"300",children:[(0,a.jsx)("div",{className:"spinner-border spinner-border-lg text-primary",role:"status",children:(0,a.jsx)("span",{className:"visually-hidden",children:"Loading..."})}),(0,a.jsx)(c.x,{typography:"body1",style:{color:"white"},children:"채팅방 입장 중..."})]})})]})}let U=s()(()=>Promise.resolve(Z),{ssr:!1,loading:()=>(0,a.jsx)("div",{className:"auth-container",children:(0,a.jsx)(h.Zb.Root,{className:"chat-rooms-card",children:(0,a.jsxs)(h.Zb.Body,{className:"card-body",children:[(0,a.jsx)(m.Kq,{gap:"300",align:"center",children:(0,a.jsx)(c.x,{typography:"heading3",children:"채팅방 목록"})}),(0,a.jsx)(m.xu,{mt:"400",children:(0,a.jsx)(L,{text:"로딩 중..."})})]})})})}),V=(0,S.Q)(U)},20798:()=>{},77507:()=>{},93406:()=>{},82613:()=>{},5152:(e,r,t)=>{e.exports=t(32602)}},e=>{var r=r=>e(e.s=r);e.O(0,[834,888,774,179],()=>r(48331)),_N_E=e.O()}]);