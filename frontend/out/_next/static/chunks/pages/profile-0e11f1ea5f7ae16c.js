(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{19344:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return t(14078)}])},83867:(e,r,t)=>{"use strict";t.d(r,{Q:()=>o,v:()=>d});var s=t(85893),a=t(67294),i=t(11163),n=t(31530),l=t(19182);let o=e=>{let r=r=>{let t=(0,i.useRouter)(),[n,o]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{l.Z.getCurrentUser()?o(!1):t.replace("/?redirect="+t.asPath)},[t]),n)?null:(0,s.jsx)(e,{...r})},t=e.displayName||e.name||"Component";return r.displayName="WithAuth(".concat(t,")"),r},d=e=>{let r=r=>{let t=(0,i.useRouter)(),[o,d]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{(async()=>{t.isReady&&(l.Z.getCurrentUser()&&"/"===t.pathname?await t.replace("/chat-rooms"):d(!1))})()},[t,t.isReady]),o)?(0,s.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",backgroundColor:"var(--vapor-color-background)",color:"var(--vapor-color-text-primary)"},children:(0,s.jsx)(n.x,{typography:"body1",children:"Loading..."})}):(0,s.jsx)(e,{...r})},t=e.displayName||e.name||"Component";return r.displayName="WithoutAuth(".concat(t,")"),r}},14078:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>g});var s=t(85893),a=t(67294),i=t(11163),n=t(18237),l=t(1539),o=t(31530),d=t(2026),c=t(31275),u=t(74303),h=t(22226),m=t(19182),p=t(83867),x=t(32726),w=t(16893);let f=e=>{let{currentImage:r,onImageChange:t}=e,[i,l]=(0,a.useState)(null),[c,h]=(0,a.useState)(""),[p,f]=(0,a.useState)(!1),j=(0,a.useRef)(null),g=e=>e?e.startsWith("http")?e:"".concat("http://3.38.186.15:5001").concat(e):null;(0,a.useEffect)(()=>{l(g(r))},[r]);let v=async e=>{var s;let a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(a)try{if(!a.type.startsWith("image/"))throw Error("이미지 파일만 업로드할 수 있습니다.");if(a.size>5242880)throw Error("파일 크기는 5MB를 초과할 수 없습니다.");f(!0),h("");let e=URL.createObjectURL(a);l(e);let r=m.Z.getCurrentUser();if(!(null==r?void 0:r.token))throw Error("인증 정보가 없습니다.");let s=new FormData;s.append("profileImage",a);let i=await fetch("".concat("http://3.38.186.15:5001","/api/users/profile-image"),{method:"POST",headers:{"x-auth-token":r.token,"x-session-id":r.sessionId},body:s});if(!i.ok){let e=await i.json();throw Error(e.message||"이미지 업로드에 실패했습니다.")}let n=await i.json(),o={...r,profileImage:n.imageUrl};localStorage.setItem("user",JSON.stringify(o)),t(n.imageUrl),window.dispatchEvent(new Event("userProfileUpdate"))}catch(e){console.error("Image upload error:",e),h(e.message),l(g(r)),i&&i.startsWith("blob:")&&URL.revokeObjectURL(i)}finally{f(!1),j.current&&(j.current.value="")}},y=async()=>{try{f(!0),h("");let e=m.Z.getCurrentUser();if(!(null==e?void 0:e.token))throw Error("인증 정보가 없습니다.");let r=await fetch("".concat("http://3.38.186.15:5001","/api/users/profile-image"),{method:"DELETE",headers:{"x-auth-token":e.token,"x-session-id":e.sessionId}});if(!r.ok){let e=await r.json();throw Error(e.message||"이미지 삭제에 실패했습니다.")}let s={...e,profileImage:""};localStorage.setItem("user",JSON.stringify(s)),i&&i.startsWith("blob:")&&URL.revokeObjectURL(i),l(null),t(""),window.dispatchEvent(new Event("userProfileUpdate"))}catch(e){console.error("Image removal error:",e),h(e.message)}finally{f(!1)}};(0,a.useEffect)(()=>()=>{i&&i.startsWith("blob:")&&URL.revokeObjectURL(i)},[i]);let b=m.Z.getCurrentUser();return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(w.Z,{user:b,size:"xl",className:"mx-auto mb-2",showInitials:!0}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsxs)(u.z,{variant:"outline",onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},disabled:p,size:"sm",children:[(0,s.jsx)(n.xmR,{size:16}),(0,s.jsx)("span",{style:{marginLeft:"8px"},children:"이미지 변경"})]}),i&&(0,s.jsx)(x.h,{variant:"outline",color:"danger",onClick:y,disabled:p,style:{marginLeft:"8px"},children:(0,s.jsx)(n.yNA,{size:16})})]})]}),(0,s.jsx)("input",{ref:j,type:"file",className:"hidden",accept:"image/*",onChange:v}),c&&(0,s.jsx)("div",{className:"w-full max-w-sm mx-auto",children:(0,s.jsx)(d.U,{color:"danger",className:"mt-2",children:c})}),p&&(0,s.jsx)(o.x,{typography:"body3",color:"neutral-weak",className:"text-center mt-2",children:"이미지 업로드 중..."})]})};var j=t(6969);let g=(0,p.Q)(()=>{let[e,r]=(0,a.useState)(null),[t,p]=(0,a.useState)({name:"",currentPassword:"",newPassword:"",confirmPassword:""}),[x,w]=(0,a.useState)(""),[g,v]=(0,a.useState)(""),[y,b]=(0,a.useState)(""),[P,E]=(0,a.useState)(!1),C=(0,i.useRouter)(),U=(0,a.useRef)(null),k=(0,a.useCallback)(e=>e?e.startsWith("http")?e:"".concat("http://3.38.186.15:5001").concat(e):null,[]);(0,a.useEffect)(()=>{let e=m.Z.getCurrentUser();if(!e){C.push("/");return}if(!U.current&&e.email){let r=(0,j.FV)(e.email),t=(0,j.pJ)(r);U.current={backgroundColor:r,color:t}}r(e),p(r=>({...r,name:e.name})),w(e.profileImage||"")},[C,k]),(0,a.useEffect)(()=>{let e=()=>{let e=m.Z.getCurrentUser();e&&(r(e),w(e.profileImage||""))};return window.addEventListener("userProfileUpdate",e),()=>{window.removeEventListener("userProfileUpdate",e)}},[]);let N=(0,a.useCallback)(async e=>{try{k(e),w(e);let t=m.Z.getCurrentUser();if(!t)throw Error("사용자 정보를 찾을 수 없습니다.");let s={...t,profileImage:e};localStorage.setItem("user",JSON.stringify(s)),r(s),b("프로필 이미지가 업데이트되었습니다."),setTimeout(()=>{b("")},3e3),window.dispatchEvent(new Event("userProfileUpdate"))}catch(e){console.error("Image update error:",e),v("프로필 이미지 업데이트에 실패했습니다."),setTimeout(()=>{v("")},3e3)}},[k]),R=async s=>{if(s.preventDefault(),v(""),b(""),t.newPassword!==t.confirmPassword){v("새 비밀번호가 일치하지 않습니다.");return}E(!0);try{if(t.currentPassword){if(!t.newPassword)throw Error("새 비밀번호를 입력해주세요.");await m.Z.changePassword(t.currentPassword,t.newPassword)}if(t.name!==e.name){let e=await m.Z.updateProfile({name:t.name});r(e)}b("프로필이 성공적으로 업데이트되었습니다."),p(e=>({...e,currentPassword:"",newPassword:"",confirmPassword:""})),window.dispatchEvent(new Event("userProfileUpdate"))}catch(e){var a,i;console.error("Profile update error:",e),v((null===(i=e.response)||void 0===i?void 0:null===(a=i.data)||void 0===a?void 0:a.message)||e.message||"프로필 업데이트 중 오류가 발생했습니다.")}finally{E(!1)}};return e?(0,s.jsx)("div",{className:"auth-container",children:(0,s.jsx)(l.Zb.Root,{className:"auth-card",children:(0,s.jsx)(l.Zb.Body,{className:"card-body",children:(0,s.jsxs)(h.Kq,{gap:"400",children:[(0,s.jsx)(h.M5,{children:(0,s.jsx)(o.x,{typography:"heading3",children:"프로필 설정"})}),(0,s.jsx)(h.M5,{children:(0,s.jsx)(f,{currentImage:x,onImageChange:N})}),g&&(0,s.jsx)(h.xu,{mt:"400",children:(0,s.jsx)(d.U,{color:"danger",children:(0,s.jsxs)(h.kC,{align:"center",gap:"200",children:[(0,s.jsx)(n.oC6,{size:16}),(0,s.jsx)(o.x,{children:g})]})})}),y&&(0,s.jsx)(h.xu,{mt:"400",children:(0,s.jsx)(d.U,{color:"success",children:(0,s.jsx)(o.x,{children:y})})}),(0,s.jsx)(h.xu,{mt:"400",children:(0,s.jsx)("form",{onSubmit:R,children:(0,s.jsxs)(h.Kq,{gap:"300",children:[(0,s.jsx)(h.xu,{children:(0,s.jsxs)(c.oi.Root,{type:"email",value:e.email,disabled:!0,children:[(0,s.jsx)(c.oi.Label,{children:"이메일"}),(0,s.jsx)(c.oi.Field,{id:"email",name:"email",required:!0,style:{width:"100%"}})]})}),(0,s.jsx)(h.xu,{children:(0,s.jsxs)(c.oi.Root,{type:"text",value:t.name,onValueChange:e=>p(r=>({...r,name:e})),disabled:P,children:[(0,s.jsx)(c.oi.Label,{children:"이름"}),(0,s.jsx)(c.oi.Field,{id:"name",name:"name",placeholder:"이름을 입력하세요",required:!0,style:{width:"100%"}})]})}),(0,s.jsx)(h.xu,{children:(0,s.jsxs)(c.oi.Root,{type:"password",value:t.currentPassword,onValueChange:e=>p(r=>({...r,currentPassword:e})),disabled:P,children:[(0,s.jsx)(c.oi.Label,{children:"현재 비밀번호"}),(0,s.jsx)(c.oi.Field,{id:"currentPassword",name:"currentPassword",placeholder:"현재 비밀번호를 입력하세요",style:{width:"100%"}})]})}),(0,s.jsx)(h.xu,{children:(0,s.jsxs)(c.oi.Root,{type:"password",value:t.newPassword,onValueChange:e=>p(r=>({...r,newPassword:e})),disabled:P,children:[(0,s.jsx)(c.oi.Label,{children:"새 비밀번호"}),(0,s.jsx)(c.oi.Field,{id:"newPassword",name:"newPassword",placeholder:"새 비밀번호를 입력하세요",style:{width:"100%"}})]})}),(0,s.jsx)(h.xu,{children:(0,s.jsxs)(c.oi.Root,{type:"password",value:t.confirmPassword,onValueChange:e=>p(r=>({...r,confirmPassword:e})),disabled:P,children:[(0,s.jsx)(c.oi.Label,{children:"새 비밀번호 확인"}),(0,s.jsx)(c.oi.Field,{id:"confirmPassword",name:"confirmPassword",placeholder:"새 비밀번호를 다시 입력하세요",style:{width:"100%"}})]})}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"var(--vapor-space-300)",marginTop:"var(--vapor-space-300)",width:"100%"},children:[(0,s.jsx)(u.z,{type:"submit",color:"primary",size:"md",disabled:P,children:P?"저장 중...":"저장"}),(0,s.jsx)(u.z,{type:"button",variant:"outline",color:"secondary",size:"md",onClick:()=>C.back(),disabled:P,children:"취소"})]})]})})})]})})})}):null})}},e=>{var r=r=>e(e.s=r);e.O(0,[834,553,888,774,179],()=>r(19344)),_N_E=e.O()}]);